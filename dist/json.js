function isJson(a){return/\.json$/.test(a)}function getJsonNode(a){var b,c=new UglifyJS.TreeWalker(function(a){a instanceof UglifyJS.AST_Object&&"("===c.parent().start.value&&(b=a)}),d=UglifyJS.parse("("+a+")");return d.walk(c),b}var path=require("path"),UglifyJS=require("uglify-js"),_=require("underscore"),plugin=module.exports=Plugin.create("json");plugin.run=function(a,b){var c=a.buildDirectory;a.moduleCache;var f;f=fsExt.list(c,/\.js$/).forEach(function(b){var d=path.join(c,b),e=fsExt.readFileSync(d),f=DepUtil.parseDynamic(e),g=f.some(function(a){return isJson(a)});g&&(e=Ast.replaceRequireNode(e,isJson,function(b,c){var g,e=a.getDepModulePath(d,c),f=fsExt.readFileSync(e);try{return g=JSON.parse(f),getJsonNode(f)}catch(h){return console.warn("无法编译 "+e),b}}),fsExt.writeFileSync(d,e))}),b()};